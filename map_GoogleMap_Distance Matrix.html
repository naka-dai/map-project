<!DOCTYPE html>
<html>
<head>
    <title>Google Maps Directions API</title>
    <meta charset="UTF-8">
    <style>
        #map {
            height: 80vh;
            width: 100%;
        }
        #controls {
            margin: 10px;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCuThOGFiWKfdFpvRywRgWVekZvhCoUFt0&callback=initMap" async defer></script>
</head>
<body>
    <div id="controls">
        <label for="radiusInput">距離（km）：</label>
        <input id="radiusInput" type="number" value="40" min="1" step="1">
        <button id="updateRoutes">経路を更新</button>
    </div>
    <div id="map"></div>

    <script>
        let map;
        let directionsService;
        let directionsRenderers = [];

        document.addEventListener("DOMContentLoaded", () => {
            initMap();
        });

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 35.6762, lng: 139.6503 }, // 日本中心
                zoom: 8,
            });

            directionsService = new google.maps.DirectionsService();

            const locations = [
                { lat: 35.6895, lng: 139.6917 }, // 東京
                { lat: 34.6937, lng: 135.5023 }, // 大阪
            ];

            locations.forEach(location => calculateRoutes(location));

            document.getElementById("updateRoutes").addEventListener("click", () => {
                clearRoutes();
                locations.forEach(location => calculateRoutes(location));
            });
        }

        function calculateRoutes(origin) {
            const destination = { lat: 34.6937, lng: 135.5023 }; // サンプル目的地

            const request = {
                origin: origin,
                destination: destination,
                travelMode: 'DRIVING',
            };

            directionsService.route(request, (result, status) => {
                if (status === 'OK') {
                    const directionsRenderer = new google.maps.DirectionsRenderer({
                        map: map,
                        suppressMarkers: true,
                        polylineOptions: {
                            strokeColor: '#FF0000',
                            strokeOpacity: 0.6,
                            strokeWeight: 3,
                        },
                    });
                    directionsRenderer.setDirections(result);
                    directionsRenderers.push(directionsRenderer);
                } else if (status === 'ZERO_RESULTS') {
                    console.warn("ルートが見つかりません:", request);
                } else {
                    console.error("Directions API error:", status);
                }
            });
        }

        function clearRoutes() {
            directionsRenderers.forEach(renderer => renderer.setMap(null));
            directionsRenderers = [];
        }
    </script>
</body>
</html>

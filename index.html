<!DOCTYPE html>
<html>
<head>
    <title>Google Maps with Circles</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCuThOGFiWKfdFpvRywRgWVekZvhCoUFt0&callback=initMap" async defer></script>
    <style>
        /* Set the size of the map */
        #map {
            height: 100%;
            width: 100%;
        }
        /* Ensure the body and html elements take up full screen height */
        html, body {
            height: 100%;
            margin: 0;
        }
    </style>
</head>
<body>
    <div id="map" style="height: 100vh;"></div> <!-- 地図を表示するために高さを指定 -->
    <script>
        var currentInfoWindow = null;  // 現在開いている情報ウィンドウを保持する変数

        function initMap() {
            // Mapの初期設定（日本全体を表示できるように中心座標とズームレベルを設定）
            var map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 37.5, lng: 137.5}, // 日本全体を表示するための中心座標
                zoom: 5  // ズームレベル5で日本全体を表示
            });

            // CSVファイルを読み込む
            fetch('AP.csv')  // CSVファイル名を 'AP.csv' に変更
                .then(response => response.text())  // テキストとしてCSVを読み込む
                .then(csvContent => {
                    var locations = parseCSV(csvContent);  // CSVをパース
                    plotLocations(map, locations);  // 地図に描画
                })
                .catch(error => console.error('CSVファイルの読み込みエラー:', error));
        }

        // CSVをパースして座標を抽出する関数
        function parseCSV(csvContent) {
            var locations = [];
            var rows = csvContent.split('\n');  // 改行で行を分ける
            rows.slice(1).forEach(function(row) {  // 1行目はヘッダなのでスキップ
                var columns = row.split(',');  // カンマで分割
                if (columns.length >= 3) {  // 緯度・経度・名称がある場合
                    var lng = parseFloat(columns[1].trim());  // 経度（2列目）
                    var lat = parseFloat(columns[2].trim());  // 緯度（3列目）
                    if (!isNaN(lat) && !isNaN(lng)) {  // 数値として有効か確認
                        var name = columns[0].trim();  // 名称（セイバン）
                        locations.push({lat: lat, lng: lng, name: name});  // 配列に追加
                    }
                }
            });
            return locations;
        }

        // 各地点にマーカーと円を描画する関数
        function plotLocations(map, locations) {
            locations.forEach(function(location) {
                // マーカーを作成
                var marker = new google.maps.Marker({
                    position: {lat: location.lat, lng: location.lng},
                    map: map
                    // title プロパティを削除
                });

                // 半径40kmの円を描画
                var circle = new google.maps.Circle({
                    map: map,
                    center: {lat: location.lat, lng: location.lng},
                    radius: 40000,  // 半径40km（メートル）
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.1  // 透過度を0.1に設定
                });

                // マーカーにマウスオーバーで地点名を表示
                marker.addListener('mouseover', function() {
                    // 現在開いている情報ウィンドウがあれば閉じる
                    if (currentInfoWindow) {
                        currentInfoWindow.close();
                    }

                    // 情報ウィンドウを作成
                    var infoWindow = new google.maps.InfoWindow({
                        content: location.name,
                        disableAutoPan: true  // 自動的に位置を調整しないようにする
                    });

                    // 情報ウィンドウを開く
                    infoWindow.open(map, marker);

                    // 現在開いている情報ウィンドウを保持
                    currentInfoWindow = infoWindow;
                });

                // マーカーからマウスアウトで情報ウィンドウを閉じる
                marker.addListener('mouseout', function() {
                    if (currentInfoWindow) {
                        currentInfoWindow.close();  // 情報ウィンドウを閉じる
                    }
                });
            });
        }
    </script>
</body>
</html>
